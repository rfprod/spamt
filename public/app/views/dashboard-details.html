<div fxFlex fxLayoutFill fxLayout="row" fxLayout.xs="column" fxLayout.sm="column" fxLayoutFill="start stretch" fxLayoutGap="5px">

	<div fxFlex *ngIf="errorMessage || successMessage">
		<div *ngIf="errorMessage" class="feedback warning" fxLayout="row" fxLayoutAlign="start stretch">
			<span fxFlex="90" fxLayout="row" fxLayoutAlign="start center">
				<i class="fa fa-warning"></i> {{errorMessage}}
			</span>
			<button type="button" class="close" (click)="dismissMessages()" aria-label="Close">&times;</button>
		</div>
		<div *ngIf="successMessage" class="feedback success" fxLayout="row" fxLayoutAlign="start stretch">
			<span fxFlex="90" fxLayout="row" fxLayoutAlign="start center">
				<i class="fa fa-check-circle"></i> {{successMessage}}
			</span>
			<button fxFlex="10" type="button" class="close" (click)="dismissMessages()" aria-label="Close">&times;</button>
		</div>
	</div>

	<div fxFlex="25" fxFlex.xs="0 1 auto" fxFlex.sm="0 1 auto">
		<legend class="mat-h3">User</legend>
		<div fxLayout="row" fxLayoutAlign="start stretch">
			<mat-form-field>
				<span matPrefix class="mat-caption" fxHide.xs="false" fxHide.gt-xs="true" fxHide.md="false" title="https://soundcloud.com/... finish the link"><i class="fa fa-link"></i> &nbsp;</span>
				<span matPrefix class="mat-caption" fxHide.xs="true" fxHide.md="true">https://soundcloud.com/ &nbsp;</span>
				<input matInput type="text" id="scUserName" name="scUserName" [formControl]="scUserName" title="username" placeholder="username" (keyup)="scUserNameKey($event)" [readonly]="userSelected()" />
				<mat-error *ngIf="scUserName.hasError('pattern')">
					must be at least 3 characters long
				</mat-error>
			</mat-form-field>
			<button mat-button [ngClass]="{ 'danger-bg': (!scUserName.value || scUserName.hasError('pattern')), 'success-bg': (scUserName.value && !scUserName.hasError('pattern')) }" (click)="getUser()" [disabled]="!scUserName.value || scUserName.hasError('pattern')" *ngIf="!userSelected()" matTooltip="Get public data">GET</button>
			<button mat-button class="danger-bg" (click)="resetSelection()" *ngIf="userSelected()" matTooltip="Reset username and data">RESET</button>
		</div>
		<div *ngIf="userSelected()" fxLayout="column" fxLayoutAlign="start stretch" fxLayoutGap="5px">
			<a mat-button [href]="publicData.user.permalink_url" target=_blank matTooltip="Open Soundcloud profile in a new tab">
				<img [src]="publicData.user.avatar_url" alt="{{publicData.user.permalink}}">
			</a>
			<div fxLayout="column" fxLayoutAlign="start stretch" fxLayoutGap="5px">
				<h3 class="mat-h3">{{publicData.user.username}}</h3>
				<h4 class="mat-h4">{{publicData.user.full_name}}</h4>
				<div fxLayout="row" fxLayoutAlign="center center" id="labels">
					<span fxFlex>{{publicData.user.plan}}</span>
					<span fxFlex>{{publicData.user.kind}}</span>
					<span fxFlex [ngClass]="{ 'success-bg': publicData.user.online, 'danger-bg': !publicData.user.online }">{{ (publicData.user.online) ? 'online' : 'offline' }}</span>
				</div>
				<table>
					<tbody>
						<tr>
							<td fxHide.xs fxHide.sm>Id</td>
							<td><i class="fa fa-info-circle" fxHide.md fxHide.lg fxHide.xl matTooltip="Id"></i> {{publicData.user.id}}</td>
						</tr>
						<tr>
							<td fxHide.xs fxHide.sm>Last&nbsp;modified</td>
							<td><i class="fa fa-clock-o" fxHide.md fxHide.lg fxHide.xl matTooltip="Last modified"></i> {{publicData.user.last_modified | date: 'yyyy-MM-dd hh:mm'}}</td>
						</tr>
						<tr>
							<td fxHide.xs fxHide.sm>Location</td>
							<td><i class="fa fa-globe" fxHide.md fxHide.lg fxHide.xl matTooltip="Location"></i> {{publicData.user.country}} / {{publicData.user.city}}</td>
						</tr>
						<tr *ngIf="publicData.user.discogs_name">
							<td fxHide.xs fxHide.sm>Discogs&nbsp;name</td>
							<td><i class="fa fa-link" fxHide.md fxHide.lg fxHide.xl matTooltip="Discogs name"></i> {{publicData.user.discogs_name}}</td>
						</tr>
						<tr *ngIf="publicData.user.myspace_name">
							<td fxHide.xs fxHide.sm>Myspace&nbsp;name</td>
							<td><i class="fa fa-link" fxHide.md fxHide.lg fxHide.xl matTooltip="Myspace name"></i> {{publicData.user.myspace_name}}</td>
						</tr>
						<tr>
							<td fxHide.xs fxHide.sm>Website</td>
							<td><a [href]="publicData.user.website" target=_blank><i class="fa fa-home" fxHide.md fxHide.lg fxHide.xl matTooltip="Website"></i> {{publicData.user.website_title}}</a></td>
						</tr>
						<tr [ngClass]="{ 'selected': selectedTab === 'Tracks' }">
							<td fxHide.xs fxHide.sm>Tracks</td>
							<td><i class="fa fa-music" fxHide.md fxHide.lg fxHide.xl matTooltip="Tracks"></i> {{publicData.user.track_count}}</td>
						</tr>
						<tr [ngClass]="{ 'selected': selectedTab === 'Playlists' }">
							<td fxHide.xs fxHide.sm>Playlists</td>
							<td><i class="fa fa-list" fxHide.md fxHide.lg fxHide.xl matTooltip="Playlists"></i> {{publicData.user.playlist_count}}</td>
						</tr>
						<tr [ngClass]="{ 'selected': selectedTab === 'Favorites' }">
							<td fxHide.xs fxHide.sm>Favorites</td>
							<td><i class="fa fa-heart" fxHide.md fxHide.lg fxHide.xl matTooltip="Public favorites"></i> {{publicData.user.public_favorites_count}}</td>
						</tr>
						<tr [ngClass]="{ 'selected': selectedTab === 'Followers' }">
							<td fxHide.xs fxHide.sm>Followers</td>
							<td><i class="fa fa-users" fxHide.md fxHide.lg fxHide.xl matTooltip="Followers"></i> {{publicData.user.followers_count}}</td>
						</tr>
						<tr [ngClass]="{ 'selected': selectedTab === 'Followings' }">
							<td fxHide.xs fxHide.sm>Followings</td>
							<td><i class="fa fa-users" fxHide.md fxHide.lg fxHide.xl matTooltip="Followings"></i> {{publicData.user.followings_count}}</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>
	<div fxFlex="75" id="scroll-content">
		<legend class="mat-h3">Data</legend>

		<span id="instructions-container" *ngIf="!userSelected()">
			<div id="instructions">
				input <a href="https://soundcloud.com" target=_blank><i class="fa fa-external-link"></i> soundcloud</a> user name to be able to request data, or select one from the following list
			</div>
			<div id="queries-flex" *ngIf="queries">
				<a fxFlex mat-button class="mat-primary" *ngFor="let q of queries.data" (click)="analyseThisUser(q.name)" matTooltip="Analyze this user">{{q.name}}</a>
			</div>
		</span>

		<div id="filters" *ngIf="selectedTab !== ''">
			<span class="flex-item">
				<mat-form-field>
					<input matInput [(ngModel)]="filterSearchQuery">
					<mat-icon matSuffix class="material-icons">search</mat-icon>
				</mat-form-field>
			</span>
			<span class="flex-item">
				<span class="input-label"><i class="fa fa-sort" aria-hidden="true"></i></span>
				<mat-select [(ngModel)]="sortByCriterion" floatPlaceholder="auto" placeholder="Sorting">
					<mat-option value="name">Alphabetical</mat-option>
					<mat-option value="timestamp">Timestamp</mat-option>
				</mat-select>
			</span>
		</div>

		<audio controls="controls" *ngIf="selectedTrack" audioPlayer>
			<source src="{{selectedTrack}}" type="audio/mpeg">
			Error: Your browser does not support <code>audio</code> element.
		</audio>

		<mat-tab-group fxHide="{{!userSelected()}}" #tabGroup [dynamicHeight]="true">
			<mat-tab *ngFor="let tab of dataTabs; let i = index">
				<ng-template mat-tab-label>
					<strong>{{tab}}</strong>
				</ng-template>

				<div class="tab-body data" *ngIf="tab === dataTabs[0]">
					<mat-card *ngFor="let track of publicData.tracks" [ngClass]="{ 'selected-track': selectedTrackURI ===  track.stream_url }" fxHide="{{hideCard(track.title)}}">
						<mat-card-content fxLayout="row">
							<div fxFlex="18" fxFlex.xs="25" fxLayout="column" fxLayoutAlign="start center">
								<div fxFlex="0 1 auto" class="cover-image-container">
									<img class="cover-image" [src]="track.artwork_url" (click)="playTrack(track.stream_url)" matTooltip="Play / Pause">
								</div>
								<div fxFlex="0 1 auto" class="mat-caption center-text">{{track.genre}}</div>
								<div fxFlex="0 1 auto" class="mat-caption center-text">{{track.license}}</div>
							</div>
							<div fxFlex fxLayout="column" fxLayoutAlign="start stretch">
								<span fxFlex class="mat-caption">{{track.created_at | date:'yyyy-MM-dd'}}</span>
								<h4 fxFlex class="mat-h4">{{track.title}}</h4>
								<span fxFlex class="waveform-container">
									<div class="underlay" *ngIf="selectedTrackURI === track.stream_url"></div>
									<img class="waveform" [src]="track.waveform_url">
								</span>
								<span class="controls" fxLayout="row" fxLayoutAlign="start stretch">
									<a (click)="playTrack(track.stream_url)" matTooltip="Play / Pause" fxFlex fxLayout="column" fxLayoutAlign="start center">
										<i class="fa fa-pause" *ngIf="audioPlayback && selectedTrackURI ===  track.stream_url" fxFlex></i>
										<i class="fa fa-play" *ngIf="!audioPlayback || (audioPlayback && selectedTrackURI !==  track.stream_url)" fxFlex></i>
										<span fxFlex class="mat-caption">{{track.playback_count}}</span>
									</a>
									<span fxFlex fxLayout="column" fxLayoutAlign="start center">
										<i class="fa fa-clock-o" fxFlex></i>
										<span fxFlex class="mat-caption">{{track.duration | duration}}</span>
									</span>
									<a (click)="downloadTrack(track.download_url)" *ngIf="track.downloadable" matTooltip="Download" fxFlex fxLayout="column" fxLayoutAlign="start center">
										<i class="fa fa-download" fxFlex></i>
									</a>
									<a [href]="track.purchase_url" target=_blank *ngIf="track.purchase_url" matTooltip="{{ track.purchase_title }}" fxFlex fxLayout="column" fxLayoutAlign="start center">
										<i class="fa fa-download" fxFlex></i>
									</a>
									<span fxFlex fxHide.xs="true" fxLayout="column" fxLayoutAlign="start center">
										<i class="fa fa-heart" fxFlex></i>
										<span fxFlex class="mat-caption">{{track.favoritings_count}}</span>
									</span>
									<span fxFlex fxHide.xs="true" fxLayout="column" fxLayoutAlign="start center">
										<i class="fa fa-comments-o" fxFlex></i>
										<span fxFlex class="mat-caption">{{track.comment_count}}</span>
									</span>
								</span>
							</div>
						</mat-card-content>
					</mat-card>
				</div>

				<div class="tab-body data" *ngIf="tab === dataTabs[1]">
					<mat-card *ngFor="let playlist of publicData.playlists; let j = index;" fxHide="{{hideCard(playlist.title)}}">
						<mat-card-content fxLayout="row">
							<div fxFlex="18" fxFlex.xs="25" fxLayout="column" fxLayoutAlign="start center">
								<div class="cover-image-container" fxFlex="0 1 auto">
									<img class="cover-image" [src]="playlist.artwork_url" (click)="togglePlaylist(j)" matTooltip="Toggle playlist">
								</div>
								<div fxFlex="0 1 auto" class="mat-caption center-text">{{playlist.genre}}</div>
								<div fxFlex="0 1 auto" class="mat-caption center-text">{{playlist.license}}</div>
							</div>
							<div fxFlex fxLayout="column" fxLayoutAlign="start stretch">
								<span fxFlex class="mat-caption">{{playlist.created_at | date:'yyyy-MM-dd'}}</span>
								<h4 fxFlex class="mat-h4">{{playlist.title}}</h4>
								<span fxFlex class="description-container">{{playlist.description}}</span>
								<span class="controls" fxLayout="row" fxLayoutAlign="start stretch">
									<a (click)="togglePlaylist(j)" fxFlex fxLayout="column" fxLayoutAlign="start center" matTooltip="Toggle playlist">
										<i class="fa fa-music" fxFlex></i>
										<span fxFlex>{{playlist.track_count}}</span>
									</a>
									<span fxFlex fxLayout="column" fxLayoutAlign="start center">
										<i class="fa fa-clock-o" fxFlex></i>
										<span fxFlex>{{playlist.duration | duration}}</span>
									</span>
									<a [href]="playlist.permalink_url" target=_blank fxFlex fxLayout="column" fxLayoutAlign="start center" matTooltip="Open Soundcloud playlist in a new tab">
										<i class="fa fa-external-link" fxFlex></i>
									</a>
									<span *ngIf="playlist.label_name" fxFlex fxLayout="column" fxLayoutAlign="start center">
										<i class="fa fa-tag" fxFlex></i>
										<span fxFlex>{{playlist.label_name}}</span>
									</span>
									<span *ngIf="playlist.release_year && playlist.release_month && playlist.release_day" fxFlex fxLayout="column" fxLayoutAlign="start center">
										<i class="fa fa-calendar" fxFlex></i>
										<span fxFlex>{{playlist.release_year}}-{{playlist.release_month}}-{{playlist.release_day}}</span>
									</span>
								</span>
								<table *ngIf="displayPlaylistTracks[j]">
									<thead>
										<tr>
											<th>#</th>
											<th>Title</th>
											<th>Genre</th>
											<th>Duration</th>
										</tr>
									</thead>
									<tbody>
										<tr *ngFor="let playlistTrack of playlist.tracks; let i = index;">
											<td>{{i}}</td>
											<td>{{playlistTrack.title}}</td>
											<td>{{playlistTrack.genre}}</td>
											<td>{{playlistTrack.duration | duration}}</td>
										</tr>
									</tbody>
								</table>
							</div>
						</mat-card-content>
					</mat-card>
				</div>

				<div class="tab-body data" *ngIf="tab === dataTabs[2]">

					<mat-card *ngFor="let track of publicData.favorites" [ngClass]="{ 'selected-track': selectedTrackURI ===  track.stream_url }" fxHide="{{hideCard(track.title)}}">
						<mat-card-content fxLayout="row">
							<div fxFlex="18" fxFlex.xs="25" fxLayout="column" fxLayoutAlign="start center">
								<div class="cover-image-container" fxFlex="0 1 auto">
									<img class="cover-image" [src]="track.artwork_url" (click)="playTrack(track.stream_url)" matTooltip="Play / Pause">
								</div>
								<div fxFlex="0 1 auto" class="mat-caption center-text">{{track.genre}}</div>
								<div fxFlex="0 1 auto" class="mat-caption center-text">{{track.license}}</div>
							</div>
							<div fxFlex fxLayout="column" fxLayoutAlign="start stretch">
								<span fxFlex class="mat-caption">{{track.created_at | date:'yyyy-MM-dd'}}</span>
								<h4 fxFlex class="mat-h4">{{track.title}}</h4>
								<span fxFlex class="waveform-container">
									<div class="underlay" *ngIf="selectedTrackURI === track.stream_url"></div>
									<img class="waveform" [src]="track.waveform_url">
								</span>
								<span class="controls" fxLayout="row" fxLayoutAlign="start stretch">
									<a (click)="playTrack(track.stream_url)" matTooltip="Play / Pause" fxFlex fxLayout="column" fxLayoutAlign="start center">
										<i fxFlex class="fa fa-pause" *ngIf="audioPlayback && selectedTrackURI ===  track.stream_url"></i>
										<i fxFlex class="fa fa-play" *ngIf="!audioPlayback || (audioPlayback && selectedTrackURI !==  track.stream_url)"></i>
										<span fxFlex class="mat-caption">{{track.playback_count}}</span>
									</a>
									<a (click)="downloadTrack(track.download_url)" *ngIf="track.downloadable" matTooltip="Download" fxFlex fxLayout="column" fxLayoutAlign="start center">
										<i fxFlex class="fa fa-download"></i>
									</a>
									<a [href]="track.purchase_url" target=_blank *ngIf="track.purchase_url" matTooltip="{{ track.purchase_title }}" fxFlex fxLayout="column" fxLayoutAlign="start center">
										<i class="fa fa-download" fxFlex></i>
									</a>
									<span fxFlex fxLayout="column" fxLayoutAlign="start center">
										<i class="fa fa-heart" fxFlex></i>
										<span fxFlex class="mat-caption">{{track.favoritings_count}}</span>
									</span>
									<span fxFlex fxLayout="column" fxLayoutAlign="start center">
										<i class="fa fa-comments-o" fxFlex></i>
										<span fxFlex class="mat-caption">{{track.comment_count}}</span>
									</span>
								</span>
							</div>
						</mat-card-content>
					</mat-card>
				</div>

				<div class="tab-body data" *ngIf="tab === dataTabs[3]">
					<mat-card *ngFor="let user of publicData.followers" fxHide="{{hideCard(user.username)}}">
						<mat-card-content fxLayout="row">
							<div fxFlex="18" fxFlex.xs="25" fxLayout="column" fxLayoutAlign="start center">
								<a class="cover-image-container" [href]="user.permalink_url" target=_blank fxFlex="0 1 auto" matTooltip="Open Soundcloud profile in a new tab">
									<img class="cover-image" [src]="user.avatar_url">
								</a>
								<div fxFlex="0 1 auto" class="mat-caption center-text">{{user.plan}}</div>
								<div fxFlex="0 1 auto" class="mat-caption center-text" [ngClass]="{ 'label-success': user.online, 'label-danger': !user.online }">&nbsp;online&nbsp;</div>
							</div>
							<div fxFlex fxLayout="column" fxLayoutAlign="start stretch">
								<span fxFlex class="mat-caption">{{user.last_modified | date:'yyyy-MM-dd'}}</span>
								<h4 fxFlex class="mat-h4">{{user.username}}</h4>
								<span fxFlex class="description-container">{{user.description}}</span>
								<span class="controls" fxLayout="row" fxLayoutAlign="start stretch">
									<span fxFlex fxLayout="column" fxLayoutAlign="start center">
										<i class="fa fa-music" fxFlex></i>
										<span fxFlex class="mat-caption">{{user.track_count}}</span>
									</span>
									<span fxFlex fxLayout="column" fxLayoutAlign="start center">
										<i class="fa fa-th-list" fxFlex></i>
										<span fxFlex class="mat-caption">{{user.playlist_count}}</span>
									</span>
									<span fxFlex fxLayout="column" fxLayoutAlign="start center">
										<i class="fa fa-heart" fxFlex></i>
										<span fxFlex class="mat-caption">{{user.public_favorites_count}}</span>
									</span>
									<span fxFlex fxLayout="column" fxLayoutAlign="start center">
										<i class="fa fa-retweet" fxFlex></i>
										<span fxFlex class="mat-caption">{{user.reposts_count}}</span>
									</span>
									<span fxFlex fxLayout="column" fxLayoutAlign="start center">
										<i class="fa fa-comments-o" fxFlex></i>
										<span fxFlex class="mat-caption">{{user.comments_count}}</span>
									</span>
									<span fxFlex fxLayout="column" fxLayoutAlign="start center">
										<span fxFlex>
											<i class="fa fa-user"></i><i class="fa fa-arrow-up"></i>
										</span>
										<span fxFlex class="mat-caption">{{user.followers_count}}</span>
									</span>
									<span fxFlex fxLayout="column" fxLayoutAlign="start center">
										<span fxFlex>
											<i class="fa fa-user"></i><i class="fa fa-arrow-down"></i>
										</span>
										<span fxFlex class="mat-caption">{{user.followings_count}}</span>
									</span>
									<a [href]="user.website" *ngIf="user.website && user.website_title" matTooltip="Open website in a new tab" fxFlex fxLayout="column" fxLayoutAlign="start center">
										<i class="fa fa-link" fxFlex></i>
										<span fxFlex class="mat-caption center-text">{{user.website_title}}</span>
									</a>
									<a (click)="analyseThisUser(user.permalink)" matTooltip="Analyse this user" fxFlex fxLayout="column" fxLayoutAlign="start center">
										<i class="fa fa-search" fxFlex></i>
									</a>
								</span>
							</div>
						</mat-card-content>
					</mat-card>
				</div>

				<div class="tab-body data" *ngIf="tab === dataTabs[4]">
					<mat-card *ngFor="let user of publicData.followings" fxHide="{{hideCard(user.username)}}">
						<mat-card-content fxLayout="row">
							<div fxFlex="18" fxFlex.xs="25" fxLayout="column" fxLayoutAlign="start center">
								<a class="cover-image-container" [href]="user.permalink_url" target=_blank fxFlex="0 1 auto" matTooltip="Open Soundcloud profile in a new tab">
									<img class="cover-image" [src]="user.avatar_url">
								</a>
								<div fxFlex="0 1 auto" class="mat-caption center-text">{{user.plan}}</div>
								<div fxFlex="0 1 auto" class="mat-caption center-text" [ngClass]="{ 'label-success': user.online, 'label-danger': !user.online }">&nbsp;online&nbsp;</div>
							</div>
							<div fxFlex fxLayout="column" fxLayoutAlign="start stretch">
								<span fxFlex class="mat-caption">{{user.last_modified | date:'yyyy-MM-dd'}}</span>
								<h4 fxFlex class="mat-h4">{{user.username}}</h4>
								<span fxFlex class="description-container">{{user.description}}</span>
								<span class="controls" fxLayout="row" fxLayoutAlign="start stretch">
									<span fxFlex fxLayout="column" fxLayoutAlign="start center">
										<i class="fa fa-music" fxFlex></i>
										<span fxFlex class="mat-caption">{{user.track_count}}</span>
									</span>
									<span fxFlex fxLayout="column" fxLayoutAlign="start center">
										<i class="fa fa-th-list" fxFlex></i>
										<span fxFlex class="mat-caption">{{user.playlist_count}}</span>
									</span>
									<span fxFlex fxLayout="column" fxLayoutAlign="start center">
										<i class="fa fa-heart" fxFlex></i>
										<span fxFlex class="mat-caption">{{user.public_favorites_count}}</span>
									</span>
									<span fxFlex fxLayout="column" fxLayoutAlign="start center">
										<i class="fa fa-retweet" fxFlex></i>
										<span fxFlex class="mat-caption">{{user.reposts_count}}</span>
									</span>
									<span fxFlex fxLayout="column" fxLayoutAlign="start center">
										<i class="fa fa-comments-o" fxFlex></i>
										<span fxFlex class="mat-caption">{{user.comments_count}}</span>
									</span>
									<span fxFlex fxLayout="column" fxLayoutAlign="start center">
										<span fxFlex>
											<i class="fa fa-user"></i><i class="fa fa-arrow-up"></i>
										</span>
										<span fxFlex class="mat-caption">{{user.followers_count}}</span>
									</span>
									<span fxFlex fxLayout="column" fxLayoutAlign="start center">
										<span fxFlex>
											<i class="fa fa-user"></i><i class="fa fa-arrow-down"></i>
										</span>
										<span fxFlex class="mat-caption">{{user.followings_count}}</span>
									</span>
									<a [href]="user.website" *ngIf="user.website && user.website_title" matTooltip="Open website in a new tab" fxFlex fxLayout="column" fxLayoutAlign="start center">
										<i class="fa fa-link" fxFlex></i>
										<span fxFlex class="mat-caption center-text">{{user.website_title}}</span>
									</a>
									<a (click)="analyseThisUser(user.permalink)" matTooltip="Analyse this user" fxFlex fxLayout="column" fxLayoutAlign="start center">
										<i class="fa fa-search" fxFlex></i>
									</a>
								</span>
							</div>
						</mat-card-content>
					</mat-card>
				</div>
			</mat-tab>
		</mat-tab-group>
	</div>
</div>
